pipeline {
    agent any

    environment {
        JMETER_VERSION = "5.6.3"
        JMETER_HOME = "/opt/jmeter/apache-jmeter-${JMETER_VERSION}"
    }

    stages {
        stage('Run Tests') {
            steps {
                script{
                    sh 'rm -f results.jtl'
                    sh 'rm -rf report_output' // reports -> report_output으로 수정 (로그 참조)
                    sh 'mkdir -p results'      // 결과 파일 저장 디렉토리 생성
                    sh 'mkdir -p report_output' // 보고서 출력 디렉토리 생성

                    sh """
                        echo "시작"
                        ${env.JMETER_HOME}/bin/jmeter -n \\
                            -t -n -t MyTestPlan.jmx \\
                            -l .\results\results.jtl \\
                            -e -o .\results\report_output
                    """
                }
            }
        }
    }

    post {
        always {
          sh'''
            echo 'Build finished.'
            '''
        }
    }
}
