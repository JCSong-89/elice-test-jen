pipeline {
    agent any

    environment {
        JMETER_VERSION = 5.5
        JMETER_HOME = "/opt/jmeter/apache-jmeter-${JMETER_VERSION}"
    }

    stages {
        stage('Run Tests') {
            steps {
                script{
                    sh 'rm -f results.jtl'
                    sh 'rm -rf reports'

                    sh """
                        echo "시작"
                        ${env.JMETER_HOME}/bin/jmeter -n \\
                            -t -n -t MyTestPlan.jmx \\
                            -l .\results\results.jtl \\
                            -e -o .\results\report_output
                    """
                }
            }
        }
    }

    post {
        always {
          sh'''
            echo 'Build finished.'
            '''
        }
    }
}
